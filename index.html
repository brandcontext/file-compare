<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>JSON Comparison Tool</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				min-height: 100vh;
				padding: 20px;
			}

			.container {
				max-width: 1400px;
				margin: 0 auto;
				background: white;
				border-radius: 20px;
				box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
				overflow: hidden;
			}

			.header {
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				color: white;
				padding: 30px;
				text-align: center;
			}

			.header h1 {
				font-size: 2.5em;
				margin-bottom: 10px;
			}

			.header p {
				font-size: 1.1em;
				opacity: 0.9;
			}

			.upload-section {
				padding: 40px;
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 30px;
				border-bottom: 2px solid #f0f0f0;
			}

			.file-upload {
				border: 3px dashed #667eea;
				border-radius: 15px;
				padding: 30px;
				text-align: center;
				transition: all 0.3s;
				cursor: pointer;
				position: relative;
			}

			.file-upload:hover {
				border-color: #764ba2;
				background: #f8f9ff;
			}

			.file-upload.loaded {
				border-color: #10b981;
				background: #f0fdf4;
			}

			.file-upload input[type="file"] {
				position: absolute;
				width: 100%;
				height: 100%;
				top: 0;
				left: 0;
				opacity: 0;
				cursor: pointer;
			}

			.file-upload-icon {
				font-size: 3em;
				margin-bottom: 15px;
			}

			.file-upload h3 {
				color: #333;
				margin-bottom: 10px;
			}

			.file-upload p {
				color: #666;
				font-size: 0.9em;
			}

			.file-name {
				margin-top: 15px;
				padding: 10px;
				background: #e0e7ff;
				border-radius: 8px;
				font-size: 0.9em;
				color: #4c1d95;
				font-weight: 600;
			}

			.controls {
				padding: 30px 40px;
				text-align: center;
				border-bottom: 2px solid #f0f0f0;
			}

			.btn {
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				color: white;
				border: none;
				padding: 15px 40px;
				border-radius: 10px;
				font-size: 1.1em;
				cursor: pointer;
				transition: all 0.3s;
				box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
			}

			.btn:hover {
				transform: translateY(-2px);
				box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
			}

			.btn:disabled {
				background: #ccc;
				cursor: not-allowed;
				transform: none;
				box-shadow: none;
			}

			.results {
				padding: 40px;
				display: none;
			}

			.results.show {
				display: block;
			}

			.stats {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 20px;
				margin-bottom: 30px;
			}

			.stat-card {
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				color: white;
				padding: 25px;
				border-radius: 15px;
				text-align: center;
				box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
			}

			.stat-card h3 {
				font-size: 2.5em;
				margin-bottom: 10px;
			}

			.stat-card p {
				font-size: 1em;
				opacity: 0.9;
			}

			.changes-container {
				background: #f8f9fa;
				border-radius: 15px;
				padding: 30px;
			}

			.change-item {
				background: white;
				border-left: 4px solid #667eea;
				padding: 20px;
				margin-bottom: 20px;
				border-radius: 8px;
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
			}

			.change-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 15px;
				padding-bottom: 15px;
				border-bottom: 2px solid #f0f0f0;
			}

			.change-path {
				font-weight: 600;
				color: #667eea;
				font-size: 1.1em;
			}

			.change-type {
				padding: 5px 15px;
				border-radius: 20px;
				font-size: 0.85em;
				font-weight: 600;
			}

			.change-type.removed {
				background: #fee2e2;
				color: #991b1b;
			}

			.change-type.modified {
				background: #fef3c7;
				color: #92400e;
			}

			.text-comparison {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 20px;
				margin-top: 15px;
			}

			.text-block {
				background: #f9fafb;
				border-radius: 8px;
				padding: 15px;
			}

			.text-block h4 {
				margin-bottom: 10px;
				color: #666;
				font-size: 0.9em;
				text-transform: uppercase;
				letter-spacing: 1px;
			}

			.text-block pre {
				white-space: pre-wrap;
				word-wrap: break-word;
				font-family: "Courier New", monospace;
				font-size: 0.9em;
				line-height: 1.6;
			}

			.original-text {
				border-left: 3px solid #ef4444;
			}

			.cleaned-text {
				border-left: 3px solid #10b981;
			}

			.diff-highlight {
				background: #fef2f2;
				color: #991b1b;
				padding: 2px 4px;
				border-radius: 3px;
				text-decoration: line-through;
			}

			.no-changes {
				text-align: center;
				padding: 60px 20px;
				color: #666;
			}

			.no-changes h2 {
				font-size: 2em;
				margin-bottom: 10px;
				color: #10b981;
			}

			@media (max-width: 768px) {
				.upload-section {
					grid-template-columns: 1fr;
				}

				.text-comparison {
					grid-template-columns: 1fr;
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<h1>üìä JSON Comparison Tool</h1>
				<p>Upload JSON files in bulk - automatically matches originals with -cleaned versions</p>
			</div>

			<div class="upload-section" style="grid-template-columns: 1fr">
				<div class="file-upload" id="bulkUpload">
					<input type="file" id="bulkFiles" accept=".json" multiple />
					<div class="file-upload-icon">üìÅ</div>
					<h3>Upload JSON Files (Bulk)</h3>
					<p>Select multiple JSON files (originals and cleaned versions)</p>
					<div class="file-name" id="bulkFileNames" style="display: none"></div>
				</div>
			</div>

			<div class="controls">
				<button class="btn" id="compareBtn" disabled>Compare All Matched Files</button>
			</div>

			<div id="matchedPairs" style="padding: 20px 40px; display: none">
				<h3 style="margin-bottom: 15px; color: #667eea">Matched File Pairs:</h3>
				<div id="pairsList"></div>
			</div>

			<div class="results" id="results">
				<div class="stats" id="stats"></div>
				<div class="changes-container" id="changesContainer"></div>
			</div>
		</div>

		<script>
			let filePairs = [];

			// Bulk file upload handler
			document.getElementById("bulkFiles").addEventListener("change", function (e) {
				handleBulkUpload(e.target.files);
			});

			function handleBulkUpload(files) {
				if (!files || files.length === 0) return;

				const fileMap = new Map();
				const cleanedFiles = new Map();
				let processedCount = 0;

				// First pass: organize files
				Array.from(files).forEach((file) => {
					const fileName = file.name;

					if (fileName.includes("-cleaned.json")) {
						// This is a cleaned file
						const baseName = fileName.replace("-cleaned.json", ".json");
						cleanedFiles.set(baseName, file);
					} else {
						// This is an original file
						fileMap.set(fileName, file);
					}
				});

				// Match pairs
				filePairs = [];
				fileMap.forEach((originalFile, fileName) => {
					const cleanedFile = cleanedFiles.get(fileName);
					if (cleanedFile) {
						filePairs.push({
							originalFile: originalFile,
							cleanedFile: cleanedFile,
							name: fileName,
						});
					}
				});

				if (filePairs.length === 0) {
					alert("No matching pairs found! Make sure you have both original and -cleaned versions of files.");
					return;
				}

				// Load all file pairs
				loadFilePairs();
			}

			function loadFilePairs() {
				let loadedPairs = 0;

				filePairs.forEach((pair, index) => {
					// Load original file
					const originalReader = new FileReader();
					originalReader.onload = function (e) {
						try {
							pair.originalData = JSON.parse(e.target.result);
							checkPairLoaded();
						} catch (error) {
							console.error(`Error parsing ${pair.originalFile.name}:`, error);
						}
					};
					originalReader.readAsText(pair.originalFile);

					// Load cleaned file
					const cleanedReader = new FileReader();
					cleanedReader.onload = function (e) {
						try {
							pair.cleanedData = JSON.parse(e.target.result);
							checkPairLoaded();
						} catch (error) {
							console.error(`Error parsing ${pair.cleanedFile.name}:`, error);
						}
					};
					cleanedReader.readAsText(pair.cleanedFile);
				});

				function checkPairLoaded() {
					loadedPairs++;
					if (loadedPairs === filePairs.length * 2) {
						// All files loaded
						displayMatchedPairs();
						document.getElementById("compareBtn").disabled = false;
						document.getElementById("bulkUpload").classList.add("loaded");
						document.getElementById("bulkFileNames").textContent = `${filePairs.length} pair(s) loaded`;
						document.getElementById("bulkFileNames").style.display = "block";
					}
				}
			}

			function displayMatchedPairs() {
				const pairsDiv = document.getElementById("pairsList");
				const matchedDiv = document.getElementById("matchedPairs");

				matchedDiv.style.display = "block";

				pairsDiv.innerHTML = filePairs
					.map(
						(pair, index) => `
					<div style="padding: 10px; margin: 5px 0; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0284c7;">
						<strong>${index + 1}.</strong> ${pair.name} ‚ÜîÔ∏è ${pair.cleanedFile.name}
					</div>
				`
					)
					.join("");
			}

			// Compare button handler
			document.getElementById("compareBtn").addEventListener("click", function () {
				if (filePairs.length === 0) return;

				const allDifferences = [];

				filePairs.forEach((pair) => {
					const differences = compareJSON(pair.originalData, pair.cleanedData);
					differences.forEach((diff) => {
						diff.fileName = pair.name;
						allDifferences.push(diff);
					});
				});

				displayResults(allDifferences);
			});

			function compareJSON(original, cleaned, path = "") {
				const differences = [];

				function traverse(obj1, obj2, currentPath) {
					if (Array.isArray(obj1) && Array.isArray(obj2)) {
						const maxLength = Math.max(obj1.length, obj2.length);
						for (let i = 0; i < maxLength; i++) {
							traverse(obj1[i], obj2[i], `${currentPath}[${i}]`);
						}
					} else if (typeof obj1 === "object" && obj1 !== null && typeof obj2 === "object" && obj2 !== null) {
						const allKeys = new Set([...Object.keys(obj1), ...Object.keys(obj2)]);
						allKeys.forEach((key) => {
							traverse(obj1[key], obj2[key], currentPath ? `${currentPath}.${key}` : key);
						});
					} else if (typeof obj1 === "string" && typeof obj2 === "string") {
						if (obj1 !== obj2) {
							differences.push({
								path: currentPath,
								original: obj1,
								cleaned: obj2,
								type: "modified",
								removedText: findRemovedText(obj1, obj2),
							});
						}
					} else if (obj1 !== obj2) {
						differences.push({
							path: currentPath,
							original: obj1,
							cleaned: obj2,
							type: obj1 && !obj2 ? "removed" : "modified",
						});
					}
				}

				traverse(original, cleaned, path);
				return differences;
			}

			function findRemovedText(original, cleaned) {
				const removed = [];

				// Find superscript numbers
				const superscripts = original.match(/[¬π¬≤¬≥‚Å¥‚Åµ‚Å∂‚Å∑‚Å∏‚Åπ‚Å∞]+/g);
				if (superscripts) removed.push(...superscripts);

				// Find extra spaces
				const extraSpaces = original.match(/  +/g);
				if (extraSpaces) removed.push("extra spaces");

				// Find learn more
				if (/learn\s+more/i.test(original)) removed.push("learn more");

				// Find terms and conditions
				if (/terms\s+and\s+conditions?/i.test(original)) removed.push("terms and conditions");

				// Find extra quotes
				if (original.match(/'{2,}/g) || original.match(/"{2,}/g)) removed.push("extra quotes");

				// Find extra dots
				if (original.match(/\.{2,}/g)) removed.push("extra dots");

				// Find extra asterisks
				if (original.match(/\*{2,}/g)) removed.push("extra asterisks");

				// Find extra underscores
				if (original.match(/_{2,}/g)) removed.push("extra underscores");

				// Find escaped quotes
				if (original.match(/\\"/g)) removed.push("escaped quotes");

				// Find ellipsis
				if (original.match(/‚Ä¶/g)) removed.push("ellipsis");

				return removed;
			}

			function highlightRemovedText(original, cleaned) {
				if (typeof original !== "string" || typeof cleaned !== "string") {
					return escapeHtml(original);
				}

				let highlighted = original;

				// Highlight superscript numbers
				highlighted = highlighted.replace(/([¬π¬≤¬≥‚Å¥‚Åµ‚Å∂‚Å∑‚Å∏‚Åπ‚Å∞]+)/g, '<span class="diff-highlight">$1</span>');

				// Highlight extra spaces (2 or more consecutive spaces)
				highlighted = highlighted.replace(/(  +)/g, '<span class="diff-highlight">$1</span>');

				// Highlight "learn more"
				highlighted = highlighted.replace(/(learn\s+more)/gi, '<span class="diff-highlight">$1</span>');

				// Highlight "terms and conditions"
				highlighted = highlighted.replace(
					/(terms\s+and\s+conditions?)/gi,
					'<span class="diff-highlight">$1</span>'
				);
				highlighted = highlighted.replace(
					/(terms\s*&\s*conditions?)/gi,
					'<span class="diff-highlight">$1</span>'
				);

				// Highlight extra quotes
				highlighted = highlighted.replace(/(''{2,})/g, '<span class="diff-highlight">$1</span>');
				highlighted = highlighted.replace(/("{2,})/g, '<span class="diff-highlight">$1</span>');

				// Highlight extra dots
				highlighted = highlighted.replace(/(\.{2,})/g, '<span class="diff-highlight">$1</span>');

				// Highlight extra asterisks
				highlighted = highlighted.replace(/(\*{2,})/g, '<span class="diff-highlight">$1</span>');

				// Highlight extra underscores
				highlighted = highlighted.replace(/(_{2,})/g, '<span class="diff-highlight">$1</span>');

				// Highlight escaped quotes
				highlighted = highlighted.replace(/(\\["'])/g, '<span class="diff-highlight">$1</span>');

				// Highlight ellipsis
				highlighted = highlighted.replace(/(‚Ä¶)/g, '<span class="diff-highlight">$1</span>');

				return highlighted;
			}

			function displayResults(differences) {
				const resultsDiv = document.getElementById("results");
				const statsDiv = document.getElementById("stats");
				const changesDiv = document.getElementById("changesContainer");

				resultsDiv.classList.add("show");

				// Calculate statistics
				const totalChanges = differences.length;
				const modifiedFields = differences.filter((d) => d.type === "modified").length;
				const removedFields = differences.filter((d) => d.type === "removed").length;
				const fileCount = filePairs.length;

				// Count what was removed
				const removedItems = {
					superscripts: 0,
					extraSpaces: 0,
					learnMore: 0,
					termsConditions: 0,
					extraQuotes: 0,
					extraDots: 0,
					extraAsterisks: 0,
					extraUnderscores: 0,
					escapedQuotes: 0,
					ellipsis: 0,
				};

				differences.forEach((diff) => {
					if (typeof diff.original === "string") {
						if (/[¬π¬≤¬≥‚Å¥‚Åµ‚Å∂‚Å∑‚Å∏‚Åπ‚Å∞]+/.test(diff.original)) removedItems.superscripts++;
						if (/  +/.test(diff.original)) removedItems.extraSpaces++;
						if (/learn\s+more/i.test(diff.original)) removedItems.learnMore++;
						if (/terms\s+and\s+conditions?/i.test(diff.original)) removedItems.termsConditions++;
						if (diff.original.match(/'{2,}/g) || diff.original.match(/"{2,}/g)) removedItems.extraQuotes++;
						if (diff.original.match(/\.{2,}/g)) removedItems.extraDots++;
						if (diff.original.match(/\*{2,}/g)) removedItems.extraAsterisks++;
						if (diff.original.match(/_{2,}/g)) removedItems.extraUnderscores++;
						if (diff.original.match(/\\"/g)) removedItems.escapedQuotes++;
						if (diff.original.match(/‚Ä¶/g)) removedItems.ellipsis++;
					}
				});

				// Display stats
				statsDiv.innerHTML = `
                <div class="stat-card">
                    <h3>${fileCount}</h3>
                    <p>Files Compared</p>
                </div>
                <div class="stat-card">
                    <h3>${totalChanges}</h3>
                    <p>Total Changes</p>
                </div>
                <div class="stat-card">
                    <h3>${removedItems.superscripts}</h3>
                    <p>Superscripts Removed</p>
                </div>
                <div class="stat-card">
                    <h3>${removedItems.extraSpaces}</h3>
                    <p>Extra Spaces Cleaned</p>
                </div>
                <div class="stat-card">
                    <h3>${removedItems.learnMore + removedItems.termsConditions}</h3>
                    <p>Unwanted Phrases</p>
                </div>
                <div class="stat-card">
                    <h3>${removedItems.extraDots + removedItems.extraAsterisks + removedItems.extraUnderscores}</h3>
                    <p>Extra Symbols</p>
                </div>
                <div class="stat-card">
                    <h3>${removedItems.ellipsis + removedItems.escapedQuotes}</h3>
                    <p>Special Characters</p>
                </div>
            `;

				// Display changes
				if (differences.length === 0) {
					changesDiv.innerHTML = `
                    <div class="no-changes">
                        <h2>‚úÖ No Changes Detected</h2>
                        <p>All files appear to be identical</p>
                    </div>
                `;
				} else {
					changesDiv.innerHTML = differences
						.map((diff) => {
							const originalText =
								typeof diff.original === "string"
									? diff.original
									: JSON.stringify(diff.original, null, 2);
							const cleanedText =
								typeof diff.cleaned === "string" ? diff.cleaned : JSON.stringify(diff.cleaned, null, 2);

							// Highlight removed text in original
							const highlightedOriginal =
								typeof diff.original === "string"
									? highlightRemovedText(diff.original, diff.cleaned)
									: escapeHtml(JSON.stringify(diff.original, null, 2));

							return `
                        <div class="change-item">
                            <div class="change-header">
                                <div>
                                    <div style="font-size: 0.85em; color: #0284c7; margin-bottom: 5px;">üìÑ ${
										diff.fileName
									}</div>
                                    <span class="change-path">${diff.path}</span>
                                </div>
                                <span class="change-type ${diff.type}">${diff.type.toUpperCase()}</span>
                            </div>
                            <div class="text-comparison">
                                <div class="text-block original-text">
                                    <h4>Original</h4>
                                    <pre>${highlightedOriginal}</pre>
                                </div>
                                <div class="text-block cleaned-text">
                                    <h4>Cleaned</h4>
                                    <pre>${escapeHtml(cleanedText)}</pre>
                                </div>
                            </div>
                            ${
								diff.removedText && diff.removedText.length > 0
									? `
                                <div style="margin-top: 15px; padding: 10px; background: #fef2f2; border-radius: 5px;">
                                    <strong>Removed:</strong> ${diff.removedText.join(", ")}
                                </div>
                            `
									: ""
							}
                        </div>
                    `;
						})
						.join("");
				}

				// Scroll to results
				resultsDiv.scrollIntoView({ behavior: "smooth" });
			}

			function escapeHtml(text) {
				const div = document.createElement("div");
				div.textContent = text;
				return div.innerHTML;
			}
		</script>
	</body>
</html>
